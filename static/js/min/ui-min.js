var ui=function(){function e(){supportsSave=new Blob?!0:!1,o(),wordCountActive=!1,supportsHtmlStorage()&&t(),console.log("Checkin under the hood eh? We've probably got a lot in common. You should totally check out ZenPen on github! (https://github.com/tholman/zenpen).")}function t(){localStorage.wordCount&&"0"!==localStorage.wordCount&&(I=parseInt(localStorage.wordCount),D.value=localStorage.wordCount,F.className="word-counter active",f()),localStorage.nightmode&&(document.body.className="false"===localStorage.nightmode?"yang":"yin")}function n(){supportsHtmlStorage()&&(localStorage.nightmode=z,localStorage.wordCount=D.value)}function o(){if(k=document.body,C=document.querySelector(".ui"),M=document.querySelector(".color-flip"),M.onclick=a,L=document.querySelector(".fullscreen"),L.onclick=c,A=document.querySelector(".target "),A.onclick=u,document.addEventListener("fullscreenchange",function(){document.fullscreenEnabled===!1&&l()},!1),supportsSave){H=document.querySelector(".save"),H.onclick=i;var e=document.querySelectorAll(".saveselection span");for(var t in e)e[t].onclick=S;document.querySelector(".savebutton").onclick=d}else document.querySelector(".save.useicons").style.display="none";x=document.querySelector(".overlay"),x.onclick=q,w=document.querySelector(".content"),w.onkeyup=g,B=x.querySelector(".wordcount"),D=B.querySelector("input"),D.onchange=m,D.onkeyup=p,T=x.querySelector(".description"),saveModal=x.querySelector(".saveoverlay"),F=document.querySelector(".word-counter"),P=F.querySelector(".progress"),N=document.querySelector(".about"),N.onclick=s,E=document.querySelector(".header"),E.onkeypress=y}function c(e){document.fullscreenElement?l():r()}function r(){document.body.requestFullscreen(Element.ALLOW_KEYBOARD_INPUT),L.innerHTML=Z}function l(){document.exitFullscreen(),L.innerHTML=Y}function a(e){document.body.className=z===!1?"yang":"yin",z=!z,n()}function u(e){x.style.display="block",B.style.display="block",D.focus()}function s(e){x.style.display="block",T.style.display="block"}function i(e){x.style.display="block",saveModal.style.display="block"}function d(e){if("undefined"!=typeof _&&""!=_){var t=new Blob([O],{type:"text/plain;charset=utf-8"}),n=E.innerHTML.replace(/(\t|\n|\r)/gm,"");""===n&&(n="ZenPen"),saveAs(t,n+".txt")}else document.querySelector(".saveoverlay h1").style.color="#FC1E1E"}function y(e){13===e.keyCode&&(e.preventDefault(),w.focus())}function p(e){13===e.keyCode&&(e.preventDefault(),v(parseInt(this.value)),b(),w.focus())}function m(e){v(parseInt(this.value))}function v(e){e>0?(I=e,F.className="word-counter active",f()):(I=0,F.className="word-counter"),n()}function g(e){I>0&&f()}function f(){var e=editor.getWordCount(),t=e/I;P.style.height=100*t+"%",P.className=t>=1?"progress complete":"progress"}function S(e){document.querySelectorAll("span.activesave").length>0&&(document.querySelector("span.activesave").className=""),document.querySelector(".saveoverlay h1").style.cssText="";var t;if(!e)var e=window.event;e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t.className="activesave",_=t.getAttribute("data-format");var n=document.querySelector("header.header"),o=n.innerHTML.replace(/(\r\n|\n|\r)/gm,"")+"\n",c=document.querySelector("article.content"),r=c.innerHTML;O=h(_,o,r);var l=document.querySelector(".hiddentextbox");l.value=O,l.focus(),l.select()}function h(e,t,n){var o;switch(e){case"html":t="<h1>"+t+"</h1>",o=t+n,o=o.replace(/\t/g,"");break;case"markdown":t=t.replace(/\t/g,""),t=t.replace(/\n$/,""),t="#"+t+"#",o=n.replace(/\t/g,""),o=o.replace(/<b>|<\/b>/g,"**").replace(/\r\n+|\r+|\n+|\t+/gi,"").replace(/<i>|<\/i>/g,"_").replace(/<blockquote>/g,"> ").replace(/<\/blockquote>/g,"").replace(/<p>|<\/p>/gi,"\n").replace(/<br>/g,"\n");var c=o.match(/<a href="(.+)">(.+)<\/a>/gi);if(null!==c)for(var r=0;r<c.length;r++){var l=document.createElement("div");l.innerHTML=c[r];var a=l.firstChild,u=a.getAttribute("href"),s=a.textContent||a.innerText||"";o=o.replace(c[r],"["+s+"]("+u+")")}o=t+"\n\n"+o;break;case"plain":t=t.replace(/\t/g,"");var a=document.createElement("div");a.innerHTML=n,o=a.textContent||a.innerText||"",o=o.replace(/\t/g,"").replace(/\n{3}/g,"\n").replace(/\n/,""),o=t+o}return o}function q(e){"overlay"===e.target.className&&b()}function b(){x.style.display="none",B.style.display="none",T.style.display="none",saveModal.style.display="none",document.querySelectorAll("span.activesave").length>0&&(document.querySelector("span.activesave").className=""),_=""}var k,w,C,x,N,T,E,L,M,A,H,I,B,D,F,P,W,_,O,Y="&#xe000;",Z="&#xe004;",z=!1;return{init:e}}();